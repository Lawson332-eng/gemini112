<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…±äº«å……ç”µå®ROIè®¡ç®—å™¨ - æŠ•èµ„å›æŠ¥åˆ†æå·¥å…·</title>
    <meta name="description" content="ä¸“ä¸šçš„å…±äº«å……ç”µå®æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè¯„ä¼°æŠ•èµ„å¯è¡Œæ€§ã€å›æ”¶å‘¨æœŸå’Œç›ˆåˆ©èƒ½åŠ›">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
        }

        .card-shadow {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .input-focus:focus {
            outline: none;
            border-color: #667EEA;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .metric-card {
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667EEA',
                        secondary: '#764BA2',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ========== è®¡ç®—å¼•æ“ ==========
        const calculateROI = (params) => {
            // åŸºç¡€å‚æ•°
            const sites = params.sites || 0;
            const ordersPerSite = params.ordersPerSite || 0;
            const pricePerOrder = params.pricePerOrder || 0;
            const deviceCost = params.deviceCost || 0;
            const venueCommission = params.venueCommission || 0;

            // é«˜çº§å‚æ•°
            const logisticsCost = params.logisticsCost || 0;
            const softwareLicense = params.softwareLicense || 0;
            const marketingCost = params.marketingCost || 0;
            const paymentFee = params.paymentFee || 0;
            const supplierCommission = params.supplierCommission || 0;
            const dailyLaborCost = params.dailyLaborCost || 0;
            const dailyCommCost = params.dailyCommCost || 0;
            const dailyMaintenanceCost = params.dailyMaintenanceCost || 0;
            const deviceWearCost = params.deviceWearCost || 0;
            const operatingDays = params.operatingDays || 365;

            // æ”¶å…¥è®¡ç®—
            const dailyOrders = sites * ordersPerSite;
            const dailyRevenue = dailyOrders * pricePerOrder;
            const monthlyRevenue = dailyRevenue * 30;
            const yearlyRevenue = dailyRevenue * operatingDays;

            // æˆæœ¬è®¡ç®—
            const initialInvestment = (deviceCost + logisticsCost) * sites + softwareLicense + marketingCost;
            const dailyOperatingCost = dailyLaborCost + dailyCommCost + dailyMaintenanceCost + (deviceWearCost * dailyOrders);
            const monthlyOperatingCost = dailyOperatingCost * 30;
            const yearlyOperatingCost = dailyOperatingCost * operatingDays;

            // åˆ©æ¶¦è®¡ç®—
            const totalCommissionRate = (venueCommission + supplierCommission + paymentFee) / 100;
            const dailyGrossIncome = dailyRevenue * (1 - totalCommissionRate);
            const dailyNetProfit = dailyGrossIncome - dailyOperatingCost;
            const monthlyNetProfit = dailyNetProfit * 30;
            const yearlyNetProfit = dailyNetProfit * operatingDays;

            // å…³é”®æŒ‡æ ‡
            const paybackPeriodDays = dailyNetProfit > 0 ? initialInvestment / dailyNetProfit : Infinity;
            const paybackPeriodMonths = paybackPeriodDays / 30;
            const annualROI = initialInvestment > 0 ? (yearlyNetProfit / initialInvestment) * 100 : 0;
            const grossMargin = dailyRevenue > 0 ? (dailyGrossIncome / dailyRevenue) * 100 : 0;
            const netMargin = dailyRevenue > 0 ? (dailyNetProfit / dailyRevenue) * 100 : 0;
            const breakEvenPoint = pricePerOrder > 0 ? (dailyOperatingCost + (dailyRevenue * totalCommissionRate)) / pricePerOrder : 0;

            return {
                revenue: {
                    daily: dailyRevenue,
                    monthly: monthlyRevenue,
                    yearly: yearlyRevenue,
                    dailyOrders
                },
                costs: {
                    initial: initialInvestment,
                    dailyOperating: dailyOperatingCost,
                    monthlyOperating: monthlyOperatingCost,
                    yearlyOperating: yearlyOperatingCost
                },
                profit: {
                    dailyGross: dailyGrossIncome,
                    dailyNet: dailyNetProfit,
                    monthlyNet: monthlyNetProfit,
                    yearlyNet: yearlyNetProfit
                },
                metrics: {
                    paybackPeriodDays,
                    paybackPeriodMonths,
                    annualROI,
                    grossMargin,
                    netMargin,
                    breakEvenPoint
                }
            };
        };

        // ========== é»˜è®¤å‚æ•°é…ç½® ==========
        const defaultParams = {
            sites: 100,
            ordersPerSite: 2.2,
            pricePerOrder: 15,
            deviceCost: 2500,
            venueCommission: 20,
            logisticsCost: 500,
            softwareLicense: 50000,
            marketingCost: 0,
            paymentFee: 3,
            supplierCommission: 0,
            dailyLaborCost: 500,
            dailyCommCost: 80,
            dailyMaintenanceCost: 40,
            deviceWearCost: 0.15,
            operatingDays: 365
        };

        // åœºæ™¯é¢„è®¾
        const scenarios = {
            conservative: {
                name: 'ä¿å®ˆåœºæ™¯',
                sites: 50,
                ordersPerSite: 1.5,
                pricePerOrder: 12,
                deviceCost: 3000,
                venueCommission: 30,
                logisticsCost: 600,
                softwareLicense: 50000,
                marketingCost: 20000,
                paymentFee: 3,
                supplierCommission: 5,
                dailyLaborCost: 600,
                dailyCommCost: 100,
                dailyMaintenanceCost: 50,
                deviceWearCost: 0.2,
                operatingDays: 365
            },
            standard: defaultParams,
            optimistic: {
                name: 'ä¹è§‚åœºæ™¯',
                sites: 200,
                ordersPerSite: 3.5,
                pricePerOrder: 18,
                deviceCost: 2000,
                venueCommission: 15,
                logisticsCost: 400,
                softwareLicense: 50000,
                marketingCost: 0,
                paymentFee: 2.5,
                supplierCommission: 0,
                dailyLaborCost: 400,
                dailyCommCost: 60,
                dailyMaintenanceCost: 30,
                deviceWearCost: 0.1,
                operatingDays: 365
            }
        };

        // ========== ä¸»åº”ç”¨ç»„ä»¶ ==========
        function App() {
            const [params, setParams] = useState(defaultParams);
            const [results, setResults] = useState(null);
            const [showAdvanced, setShowAdvanced] = useState(false);
            const [activeTab, setActiveTab] = useState('overview');

            useEffect(() => {
                const calculated = calculateROI(params);
                setResults(calculated);
            }, [params]);

            const updateParam = (key, value) => {
                setParams(prev => ({ ...prev, [key]: parseFloat(value) || 0 }));
            };

            const loadScenario = (scenario) => {
                setParams(scenarios[scenario]);
            };

            const formatNumber = (num, decimals = 0) => {
                if (!isFinite(num)) return 'âˆ';
                return num.toLocaleString('zh-CN', {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals
                });
            };

            const formatCurrency = (num) => {
                return 'Â¥' + formatNumber(num, 2);
            };

            const getPaybackRating = (months) => {
                if (!isFinite(months)) return { text: 'æ— æ³•å›æœ¬', color: 'red' };
                if (months <= 6) return { text: 'ä¼˜ç§€', color: 'green' };
                if (months <= 12) return { text: 'è‰¯å¥½', color: 'blue' };
                if (months <= 24) return { text: 'ä¸€èˆ¬', color: 'yellow' };
                return { text: 'è¾ƒå·®', color: 'orange' };
            };

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="gradient-bg text-white py-8 shadow-lg">
                        <div className="container mx-auto px-4">
                            <h1 className="text-4xl font-bold mb-2">å…±äº«å……ç”µå®ROIè®¡ç®—å™¨</h1>
                            <p className="text-white/80">ä¸“ä¸šæŠ•èµ„å›æŠ¥åˆ†æå·¥å…· - æ•°æ®é©±åŠ¨å†³ç­–</p>
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="container mx-auto px-4 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Left: Parameters Input */}
                            <div className="lg:col-span-1">
                                <ParameterInput
                                    params={params}
                                    updateParam={updateParam}
                                    showAdvanced={showAdvanced}
                                    setShowAdvanced={setShowAdvanced}
                                    loadScenario={loadScenario}
                                />
                            </div>

                            {/* Right: Results Display */}
                            <div className="lg:col-span-2">
                                {results && (
                                    <ResultsDisplay
                                        results={results}
                                        params={params}
                                        formatNumber={formatNumber}
                                        formatCurrency={formatCurrency}
                                        getPaybackRating={getPaybackRating}
                                        activeTab={activeTab}
                                        setActiveTab={setActiveTab}
                                    />
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-6 mt-16">
                        <div className="container mx-auto px-4 text-center">
                            <p className="text-gray-400">Â© 2025 å…±äº«å……ç”µå®ROIè®¡ç®—å™¨ | ä»…ä¾›å‚è€ƒï¼ŒæŠ•èµ„éœ€è°¨æ…</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // ========== å‚æ•°è¾“å…¥ç»„ä»¶ ==========
        function ParameterInput({ params, updateParam, showAdvanced, setShowAdvanced, loadScenario }) {
            return (
                <div className="bg-white rounded-xl card-shadow p-6 animate-fade-in sticky top-4">
                    <h2 className="text-2xl font-bold mb-6 text-gray-800">å‚æ•°è®¾ç½®</h2>

                    {/* åœºæ™¯é¢„è®¾ */}
                    <div className="mb-6">
                        <label className="block text-sm font-semibold text-gray-700 mb-3">å¿«é€Ÿåœºæ™¯</label>
                        <div className="grid grid-cols-3 gap-2">
                            <button
                                onClick={() => loadScenario('conservative')}
                                className="px-3 py-2 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition text-sm font-medium"
                            >
                                ä¿å®ˆ
                            </button>
                            <button
                                onClick={() => loadScenario('standard')}
                                className="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-sm font-medium"
                            >
                                æ ‡å‡†
                            </button>
                            <button
                                onClick={() => loadScenario('optimistic')}
                                className="px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-sm font-medium"
                            >
                                ä¹è§‚
                            </button>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {/* åŸºç¡€å‚æ•° */}
                        <div className="pb-4 border-b border-gray-200">
                            <h3 className="font-semibold text-gray-700 mb-4 flex items-center">
                                <span className="w-2 h-2 bg-primary rounded-full mr-2"></span>
                                åŸºç¡€å‚æ•°
                            </h3>

                            <InputField
                                label="æŠ•æ”¾ç«™ç‚¹æ•°é‡"
                                value={params.sites}
                                onChange={(v) => updateParam('sites', v)}
                                unit="ä¸ª"
                                min="1"
                                max="10000"
                            />

                            <InputField
                                label="æ¯ç«™ç‚¹æ—¥å‡è®¢å•"
                                value={params.ordersPerSite}
                                onChange={(v) => updateParam('ordersPerSite', v)}
                                unit="å•"
                                step="0.1"
                                min="0.1"
                                max="100"
                            />

                            <InputField
                                label="å•æ¬¡ç§Ÿèµä»·æ ¼"
                                value={params.pricePerOrder}
                                onChange={(v) => updateParam('pricePerOrder', v)}
                                unit="å…ƒ"
                                step="0.5"
                                min="0.5"
                                max="100"
                            />

                            <InputField
                                label="å•ç«™è®¾å¤‡æˆæœ¬"
                                value={params.deviceCost}
                                onChange={(v) => updateParam('deviceCost', v)}
                                unit="å…ƒ"
                                min="100"
                                max="50000"
                            />

                            <InputField
                                label="åœºåœ°åˆ†æˆæ¯”ä¾‹"
                                value={params.venueCommission}
                                onChange={(v) => updateParam('venueCommission', v)}
                                unit="%"
                                step="1"
                                min="0"
                                max="80"
                            />
                        </div>

                        {/* é«˜çº§å‚æ•° */}
                        <div>
                            <button
                                onClick={() => setShowAdvanced(!showAdvanced)}
                                className="w-full flex items-center justify-between py-2 text-primary hover:text-secondary transition font-semibold"
                            >
                                <span className="flex items-center">
                                    <span className="w-2 h-2 bg-secondary rounded-full mr-2"></span>
                                    é«˜çº§å‚æ•°
                                </span>
                                <svg
                                    className={`w-5 h-5 transition-transform ${showAdvanced ? 'rotate-180' : ''}`}
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>

                            {showAdvanced && (
                                <div className="mt-4 space-y-4 animate-fade-in">
                                    <InputField
                                        label="å•ç«™ç‰©æµæˆæœ¬"
                                        value={params.logisticsCost}
                                        onChange={(v) => updateParam('logisticsCost', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="è½¯ä»¶è®¸å¯è´¹"
                                        value={params.softwareLicense}
                                        onChange={(v) => updateParam('softwareLicense', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="è¥é”€æ¨å¹¿è´¹"
                                        value={params.marketingCost}
                                        onChange={(v) => updateParam('marketingCost', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="æ”¯ä»˜æ‰‹ç»­è´¹ç‡"
                                        value={params.paymentFee}
                                        onChange={(v) => updateParam('paymentFee', v)}
                                        unit="%"
                                        step="0.1"
                                    />

                                    <InputField
                                        label="ä¾›åº”å•†åˆ†æˆæ¯”ä¾‹"
                                        value={params.supplierCommission}
                                        onChange={(v) => updateParam('supplierCommission', v)}
                                        unit="%"
                                        step="1"
                                    />

                                    <InputField
                                        label="æ—¥å‡äººå·¥æˆæœ¬"
                                        value={params.dailyLaborCost}
                                        onChange={(v) => updateParam('dailyLaborCost', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="æ—¥å‡é€šä¿¡æˆæœ¬"
                                        value={params.dailyCommCost}
                                        onChange={(v) => updateParam('dailyCommCost', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="æ—¥å‡ç³»ç»Ÿç»´æŠ¤è´¹"
                                        value={params.dailyMaintenanceCost}
                                        onChange={(v) => updateParam('dailyMaintenanceCost', v)}
                                        unit="å…ƒ"
                                    />

                                    <InputField
                                        label="å……ç”µå®æŸè€—æˆæœ¬"
                                        value={params.deviceWearCost}
                                        onChange={(v) => updateParam('deviceWearCost', v)}
                                        unit="å…ƒ/å•"
                                        step="0.01"
                                    />

                                    <InputField
                                        label="é¢„æœŸè¿è¥å¤©æ•°"
                                        value={params.operatingDays}
                                        onChange={(v) => updateParam('operatingDays', v)}
                                        unit="å¤©"
                                        min="180"
                                        max="365"
                                    />
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // ========== è¾“å…¥å­—æ®µç»„ä»¶ ==========
        function InputField({ label, value, onChange, unit, step = "1", min = "0", max }) {
            return (
                <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                        {label}
                    </label>
                    <div className="relative">
                        <input
                            type="number"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            step={step}
                            min={min}
                            max={max}
                            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg input-focus transition"
                        />
                        {unit && (
                            <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">
                                {unit}
                            </span>
                        )}
                    </div>
                </div>
            );
        }

        // ========== ç»“æœå±•ç¤ºç»„ä»¶ ==========
        function ResultsDisplay({ results, params, formatNumber, formatCurrency, getPaybackRating, activeTab, setActiveTab }) {
            const rating = getPaybackRating(results.metrics.paybackPeriodMonths);

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* å…³é”®æŒ‡æ ‡å¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <MetricCard
                            title="æŠ•èµ„å›æ”¶æœŸ"
                            value={isFinite(results.metrics.paybackPeriodMonths) ? `${formatNumber(results.metrics.paybackPeriodMonths, 1)}æœˆ` : 'æ— æ³•å›æœ¬'}
                            subtitle={isFinite(results.metrics.paybackPeriodDays) ? `${formatNumber(results.metrics.paybackPeriodDays, 0)}å¤©` : ''}
                            badge={rating.text}
                            badgeColor={rating.color}
                            icon="â±ï¸"
                        />

                        <MetricCard
                            title="å¹´åŒ–ROI"
                            value={`${formatNumber(results.metrics.annualROI, 1)}%`}
                            subtitle={results.metrics.annualROI >= 100 ? 'å›æŠ¥ç‡ä¼˜ç§€' : results.metrics.annualROI >= 50 ? 'å›æŠ¥ç‡è‰¯å¥½' : 'å›æŠ¥ç‡ä¸€èˆ¬'}
                            icon="ğŸ“ˆ"
                        />

                        <MetricCard
                            title="æœˆå‡€åˆ©æ¶¦"
                            value={formatCurrency(results.profit.monthlyNet)}
                            subtitle="EBITDA"
                            icon="ğŸ’°"
                        />

                        <MetricCard
                            title="ç›ˆäºå¹³è¡¡ç‚¹"
                            value={`${formatNumber(results.metrics.breakEvenPoint, 0)}å•/å¤©`}
                            subtitle={`å½“å‰${formatNumber(results.revenue.dailyOrders, 0)}å•/å¤©`}
                            icon="âš–ï¸"
                        />
                    </div>

                    {/* è¯¦ç»†æ•°æ®å±•ç¤º */}
                    <div className="bg-white rounded-xl card-shadow p-6">
                        {/* Tabs */}
                        <div className="flex border-b border-gray-200 mb-6 overflow-x-auto">
                            <TabButton active={activeTab === 'overview'} onClick={() => setActiveTab('overview')}>
                                æ¦‚è§ˆ
                            </TabButton>
                            <TabButton active={activeTab === 'revenue'} onClick={() => setActiveTab('revenue')}>
                                æ”¶å…¥åˆ†æ
                            </TabButton>
                            <TabButton active={activeTab === 'cost'} onClick={() => setActiveTab('cost')}>
                                æˆæœ¬åˆ†æ
                            </TabButton>
                            <TabButton active={activeTab === 'profit'} onClick={() => setActiveTab('profit')}>
                                åˆ©æ¶¦åˆ†æ
                            </TabButton>
                            <TabButton active={activeTab === 'charts'} onClick={() => setActiveTab('charts')}>
                                å¯è§†åŒ–
                            </TabButton>
                        </div>

                        {/* Tab Content */}
                        <div className="animate-fade-in">
                            {activeTab === 'overview' && (
                                <OverviewTab results={results} formatNumber={formatNumber} formatCurrency={formatCurrency} />
                            )}
                            {activeTab === 'revenue' && (
                                <RevenueTab results={results} params={params} formatNumber={formatNumber} formatCurrency={formatCurrency} />
                            )}
                            {activeTab === 'cost' && (
                                <CostTab results={results} params={params} formatNumber={formatNumber} formatCurrency={formatCurrency} />
                            )}
                            {activeTab === 'profit' && (
                                <ProfitTab results={results} formatNumber={formatNumber} formatCurrency={formatCurrency} />
                            )}
                            {activeTab === 'charts' && (
                                <ChartsTab results={results} params={params} />
                            )}
                        </div>

                        {/* Export Buttons */}
                        <ExportButtons results={results} params={params} />
                    </div>
                </div>
            );
        }

        // ========== æŒ‡æ ‡å¡ç‰‡ç»„ä»¶ ==========
        function MetricCard({ title, value, subtitle, badge, badgeColor, icon }) {
            const badgeColors = {
                green: 'bg-green-100 text-green-800',
                blue: 'bg-blue-100 text-blue-800',
                yellow: 'bg-yellow-100 text-yellow-800',
                orange: 'bg-orange-100 text-orange-800',
                red: 'bg-red-100 text-red-800'
            };

            return (
                <div className="bg-white rounded-xl card-shadow p-6 metric-card">
                    <div className="flex items-start justify-between mb-3">
                        <p className="text-gray-600 text-sm font-medium">{title}</p>
                        <span className="text-2xl">{icon}</span>
                    </div>
                    <p className="text-2xl font-bold text-gray-800 mb-2">{value}</p>
                    {subtitle && <p className="text-sm text-gray-500">{subtitle}</p>}
                    {badge && (
                        <span className={`inline-block mt-3 px-3 py-1 rounded-full text-xs font-semibold ${badgeColors[badgeColor] || 'bg-gray-100 text-gray-800'}`}>
                            {badge}
                        </span>
                    )}
                </div>
            );
        }

        // ========== TabæŒ‰é’®ç»„ä»¶ ==========
        function TabButton({ active, onClick, children }) {
            return (
                <button
                    onClick={onClick}
                    className={`px-6 py-3 font-semibold transition whitespace-nowrap ${
                        active
                            ? 'text-primary border-b-2 border-primary'
                            : 'text-gray-500 hover:text-gray-700'
                    }`}
                >
                    {children}
                </button>
            );
        }

        // ========== æ¦‚è§ˆTab ==========
        function OverviewTab({ results, formatNumber, formatCurrency }) {
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <DataSection title="æ”¶å…¥æ¦‚è§ˆ">
                        <DataRow label="æ—¥è¥ä¸šé¢" value={formatCurrency(results.revenue.daily)} />
                        <DataRow label="æœˆè¥ä¸šé¢" value={formatCurrency(results.revenue.monthly)} />
                        <DataRow label="å¹´è¥ä¸šé¢" value={formatCurrency(results.revenue.yearly)} />
                        <DataRow label="æ—¥æ€»è®¢å•æ•°" value={`${formatNumber(results.revenue.dailyOrders, 1)}å•`} />
                    </DataSection>

                    <DataSection title="æˆæœ¬æ¦‚è§ˆ">
                        <DataRow label="åˆå§‹æŠ•èµ„" value={formatCurrency(results.costs.initial)} />
                        <DataRow label="æ—¥è¿è¥æˆæœ¬" value={formatCurrency(results.costs.dailyOperating)} />
                        <DataRow label="æœˆè¿è¥æˆæœ¬" value={formatCurrency(results.costs.monthlyOperating)} />
                        <DataRow label="å¹´è¿è¥æˆæœ¬" value={formatCurrency(results.costs.yearlyOperating)} />
                    </DataSection>

                    <DataSection title="åˆ©æ¶¦æ¦‚è§ˆ">
                        <DataRow label="æ—¥æ¯›æ”¶å…¥" value={formatCurrency(results.profit.dailyGross)} />
                        <DataRow label="æ—¥å‡€åˆ©æ¶¦" value={formatCurrency(results.profit.dailyNet)} highlight />
                        <DataRow label="æœˆå‡€åˆ©æ¶¦" value={formatCurrency(results.profit.monthlyNet)} highlight />
                        <DataRow label="å¹´å‡€åˆ©æ¶¦" value={formatCurrency(results.profit.yearlyNet)} highlight />
                    </DataSection>

                    <DataSection title="å…³é”®æŒ‡æ ‡">
                        <DataRow label="æ¯›åˆ©ç‡" value={`${formatNumber(results.metrics.grossMargin, 1)}%`} />
                        <DataRow label="å‡€åˆ©ç‡" value={`${formatNumber(results.metrics.netMargin, 1)}%`} />
                        <DataRow label="å¹´åŒ–ROI" value={`${formatNumber(results.metrics.annualROI, 1)}%`} highlight />
                        <DataRow label="å›æ”¶æœŸ" value={isFinite(results.metrics.paybackPeriodMonths) ? `${formatNumber(results.metrics.paybackPeriodMonths, 1)}æœˆ` : 'æ— æ³•å›æœ¬'} highlight />
                    </DataSection>
                </div>
            );
        }

        // ========== æ”¶å…¥åˆ†æTab ==========
        function RevenueTab({ results, params, formatNumber, formatCurrency }) {
            const totalCommission = (params.venueCommission + params.supplierCommission + params.paymentFee);
            const commissionAmount = results.revenue.daily * totalCommission / 100;

            return (
                <div className="space-y-6">
                    <DataSection title="æ”¶å…¥æ˜ç»†">
                        <DataRow label="æ—¥æ€»è®¢å•æ•°" value={`${formatNumber(results.revenue.dailyOrders, 1)}å•`} />
                        <DataRow label="å•æ¬¡ç§Ÿèµä»·æ ¼" value={formatCurrency(params.pricePerOrder)} />
                        <DataRow label="æ—¥è¥ä¸šé¢" value={formatCurrency(results.revenue.daily)} highlight />
                        <DataRow label="æœˆè¥ä¸šé¢" value={formatCurrency(results.revenue.monthly)} />
                        <DataRow label="å¹´è¥ä¸šé¢" value={formatCurrency(results.revenue.yearly)} />
                    </DataSection>

                    <DataSection title="æ”¶å…¥åˆ†æˆæ˜ç»†">
                        <DataRow label="åœºåœ°åˆ†æˆ" value={`${params.venueCommission}% - ${formatCurrency(results.revenue.daily * params.venueCommission / 100)}/å¤©`} />
                        <DataRow label="æ”¯ä»˜æ‰‹ç»­è´¹" value={`${params.paymentFee}% - ${formatCurrency(results.revenue.daily * params.paymentFee / 100)}/å¤©`} />
                        {params.supplierCommission > 0 && (
                            <DataRow label="ä¾›åº”å•†åˆ†æˆ" value={`${params.supplierCommission}% - ${formatCurrency(results.revenue.daily * params.supplierCommission / 100)}/å¤©`} />
                        )}
                        <DataRow label="æ€»åˆ†æˆæ¯”ä¾‹" value={`${formatNumber(totalCommission, 1)}%`} />
                        <DataRow label="æ€»åˆ†æˆé‡‘é¢" value={formatCurrency(commissionAmount)} />
                        <DataRow label="å®é™…åˆ°è´¦æ”¶å…¥" value={formatCurrency(results.profit.dailyGross)} highlight />
                    </DataSection>
                </div>
            );
        }

        // ========== æˆæœ¬åˆ†æTab ==========
        function CostTab({ results, params, formatNumber, formatCurrency }) {
            return (
                <div className="space-y-6">
                    <DataSection title="åˆå§‹æŠ•èµ„æ„æˆ (CAPEX)">
                        <DataRow label="è®¾å¤‡æˆæœ¬" value={formatCurrency(params.deviceCost * params.sites)} />
                        <DataRow label="ç‰©æµæˆæœ¬" value={formatCurrency(params.logisticsCost * params.sites)} />
                        <DataRow label="è½¯ä»¶è®¸å¯è´¹" value={formatCurrency(params.softwareLicense)} />
                        <DataRow label="è¥é”€æ¨å¹¿è´¹" value={formatCurrency(params.marketingCost)} />
                        <DataRow label="åˆå§‹æŠ•èµ„æ€»é¢" value={formatCurrency(results.costs.initial)} highlight />
                    </DataSection>

                    <DataSection title="æ—¥è¿è¥æˆæœ¬æ˜ç»† (OPEX)">
                        <DataRow label="äººå·¥æˆæœ¬" value={formatCurrency(params.dailyLaborCost)} />
                        <DataRow label="é€šä¿¡æˆæœ¬" value={formatCurrency(params.dailyCommCost)} />
                        <DataRow label="ç³»ç»Ÿç»´æŠ¤è´¹" value={formatCurrency(params.dailyMaintenanceCost)} />
                        <DataRow label="è®¾å¤‡æŸè€—" value={formatCurrency(params.deviceWearCost * results.revenue.dailyOrders)} />
                        <DataRow label="æ—¥è¿è¥æˆæœ¬æ€»è®¡" value={formatCurrency(results.costs.dailyOperating)} highlight />
                    </DataSection>

                    <DataSection title="æˆæœ¬å æ¯”åˆ†æ">
                        <DataRow
                            label="è¿è¥æˆæœ¬å è¥ä¸šé¢æ¯”"
                            value={`${formatNumber((results.costs.dailyOperating / results.revenue.daily) * 100, 1)}%`}
                        />
                        <DataRow
                            label="å•ç«™æ¯æ—¥æˆæœ¬"
                            value={formatCurrency(results.costs.dailyOperating / params.sites)}
                        />
                        <DataRow
                            label="å•å•å¹³å‡æˆæœ¬"
                            value={formatCurrency(results.costs.dailyOperating / results.revenue.dailyOrders)}
                        />
                    </DataSection>
                </div>
            );
        }

        // ========== åˆ©æ¶¦åˆ†æTab ==========
        function ProfitTab({ results, formatNumber, formatCurrency }) {
            return (
                <div className="space-y-6">
                    <DataSection title="åˆ©æ¶¦æ˜ç»†">
                        <DataRow label="æ—¥è¥ä¸šé¢" value={formatCurrency(results.revenue.daily)} />
                        <DataRow label="æ—¥æ¯›æ”¶å…¥" value={formatCurrency(results.profit.dailyGross)} />
                        <DataRow label="æ—¥è¿è¥æˆæœ¬" value={formatCurrency(results.costs.dailyOperating)} />
                        <DataRow label="æ—¥å‡€åˆ©æ¶¦" value={formatCurrency(results.profit.dailyNet)} highlight />
                        <DataRow label="æœˆå‡€åˆ©æ¶¦" value={formatCurrency(results.profit.monthlyNet)} highlight />
                        <DataRow label="å¹´å‡€åˆ©æ¶¦" value={formatCurrency(results.profit.yearlyNet)} highlight />
                    </DataSection>

                    <DataSection title="åˆ©æ¶¦ç‡æŒ‡æ ‡">
                        <DataRow label="æ¯›åˆ©ç‡" value={`${formatNumber(results.metrics.grossMargin, 2)}%`} />
                        <DataRow label="å‡€åˆ©ç‡" value={`${formatNumber(results.metrics.netMargin, 2)}%`} />
                        <DataRow
                            label="è¾¹é™…è´¡çŒ®ç‡"
                            value={`${formatNumber(100 - (results.costs.dailyOperating / results.revenue.daily) * 100, 2)}%`}
                        />
                    </DataSection>

                    <DataSection title="ç°é‡‘æµåˆ†æ">
                        <DataRow label="åˆå§‹æŠ•èµ„" value={formatCurrency(results.costs.initial)} />
                        <DataRow label="æœˆç°é‡‘æµå…¥" value={formatCurrency(results.profit.monthlyNet)} />
                        <DataRow label="å¹´ç°é‡‘æµå…¥" value={formatCurrency(results.profit.yearlyNet)} />
                        <DataRow
                            label="3å¹´ç´¯è®¡ç°é‡‘æµ"
                            value={formatCurrency(results.profit.yearlyNet * 3 - results.costs.initial)}
                            highlight
                        />
                    </DataSection>
                </div>
            );
        }

        // ========== å¯è§†åŒ–Tab ==========
        function ChartsTab({ results, params }) {
            const revenueChartRef = useRef(null);
            const costChartRef = useRef(null);
            const profitChartRef = useRef(null);
            const paybackChartRef = useRef(null);

            useEffect(() => {
                // æ”¶ç›Šæ›²çº¿å›¾
                if (revenueChartRef.current) {
                    const ctx = revenueChartRef.current.getContext('2d');
                    const months = Array.from({ length: 24 }, (_, i) => i + 1);
                    const cumulativeProfit = months.map(m => results.profit.monthlyNet * m - results.costs.initial);

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: months.map(m => `${m}æœˆ`),
                            datasets: [{
                                label: 'ç´¯è®¡å‡€åˆ©æ¶¦',
                                data: cumulativeProfit,
                                borderColor: '#667EEA',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: '24ä¸ªæœˆç´¯è®¡æ”¶ç›Šè¶‹åŠ¿',
                                    font: { size: 16, weight: 'bold' }
                                },
                                legend: { display: true }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: (value) => 'Â¥' + value.toLocaleString()
                                    }
                                }
                            }
                        }
                    });
                }

                // æˆæœ¬æ„æˆé¥¼å›¾
                if (costChartRef.current) {
                    const ctx = costChartRef.current.getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['è®¾å¤‡æˆæœ¬', 'ç‰©æµæˆæœ¬', 'è½¯ä»¶è®¸å¯', 'è¥é”€è´¹ç”¨'],
                            datasets: [{
                                data: [
                                    params.deviceCost * params.sites,
                                    params.logisticsCost * params.sites,
                                    params.softwareLicense,
                                    params.marketingCost
                                ],
                                backgroundColor: ['#667EEA', '#764BA2', '#4CAF50', '#FF9800']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'åˆå§‹æŠ•èµ„æ„æˆ',
                                    font: { size: 16, weight: 'bold' }
                                },
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }

                // åˆ©æ¶¦åˆ†è§£æ¡å½¢å›¾
                if (profitChartRef.current) {
                    const ctx = profitChartRef.current.getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['æ—¥', 'æœˆ', 'å¹´'],
                            datasets: [
                                {
                                    label: 'è¥ä¸šé¢',
                                    data: [results.revenue.daily, results.revenue.monthly, results.revenue.yearly],
                                    backgroundColor: '#667EEA'
                                },
                                {
                                    label: 'è¿è¥æˆæœ¬',
                                    data: [results.costs.dailyOperating, results.costs.monthlyOperating, results.costs.yearlyOperating],
                                    backgroundColor: '#FF9800'
                                },
                                {
                                    label: 'å‡€åˆ©æ¶¦',
                                    data: [results.profit.dailyNet, results.profit.monthlyNet, results.profit.yearlyNet],
                                    backgroundColor: '#4CAF50'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'æ”¶å…¥-æˆæœ¬-åˆ©æ¶¦å¯¹æ¯”',
                                    font: { size: 16, weight: 'bold' }
                                },
                                legend: { position: 'bottom' }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: (value) => 'Â¥' + value.toLocaleString()
                                    }
                                }
                            }
                        }
                    });
                }

                // ç›ˆäºå¹³è¡¡å›¾
                if (paybackChartRef.current && isFinite(results.metrics.paybackPeriodMonths)) {
                    const ctx = paybackChartRef.current.getContext('2d');
                    const months = Array.from({ length: Math.ceil(results.metrics.paybackPeriodMonths) + 6 }, (_, i) => i);
                    const investment = months.map(m => -results.costs.initial);
                    const profit = months.map(m => results.profit.monthlyNet * m - results.costs.initial);

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: months.map(m => `${m}æœˆ`),
                            datasets: [
                                {
                                    label: 'åˆå§‹æŠ•èµ„',
                                    data: investment,
                                    borderColor: '#F44336',
                                    borderDash: [5, 5],
                                    fill: false
                                },
                                {
                                    label: 'ç´¯è®¡å‡€åˆ©æ¶¦',
                                    data: profit,
                                    borderColor: '#4CAF50',
                                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'ç›ˆäºå¹³è¡¡åˆ†æ',
                                    font: { size: 16, weight: 'bold' }
                                },
                                legend: { position: 'bottom' },
                                annotation: {
                                    annotations: {
                                        line1: {
                                            type: 'line',
                                            yMin: 0,
                                            yMax: 0,
                                            borderColor: '#333',
                                            borderWidth: 2
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: (value) => 'Â¥' + value.toLocaleString()
                                    }
                                }
                            }
                        }
                    });
                }
            }, [results, params]);

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-gray-50 p-4 rounded-lg">
                        <canvas ref={revenueChartRef} height="250"></canvas>
                    </div>
                    <div className="bg-gray-50 p-4 rounded-lg">
                        <canvas ref={costChartRef} height="250"></canvas>
                    </div>
                    <div className="bg-gray-50 p-4 rounded-lg">
                        <canvas ref={profitChartRef} height="250"></canvas>
                    </div>
                    <div className="bg-gray-50 p-4 rounded-lg">
                        <canvas ref={paybackChartRef} height="250"></canvas>
                    </div>
                </div>
            );
        }

        // ========== æ•°æ®åŒºå—ç»„ä»¶ ==========
        function DataSection({ title, children }) {
            return (
                <div>
                    <h3 className="text-lg font-bold text-gray-800 mb-4 pb-2 border-b-2 border-primary">
                        {title}
                    </h3>
                    <div className="space-y-3">
                        {children}
                    </div>
                </div>
            );
        }

        // ========== æ•°æ®è¡Œç»„ä»¶ ==========
        function DataRow({ label, value, highlight }) {
            return (
                <div className={`flex justify-between items-center py-2 ${highlight ? 'font-bold text-primary' : ''}`}>
                    <span className="text-gray-700">{label}</span>
                    <span className={highlight ? 'text-xl' : 'text-gray-900 font-medium'}>{value}</span>
                </div>
            );
        }

        // ========== å¯¼å‡ºæŒ‰é’®ç»„ä»¶ ==========
        function ExportButtons({ results, params }) {
            const exportToPDF = () => {
                alert('PDFå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...\n\nå°†åŒ…å«å®Œæ•´çš„æŠ•èµ„åˆ†ææŠ¥å‘Šã€å…³é”®æŒ‡æ ‡å’Œå›¾è¡¨');
            };

            const exportToExcel = () => {
                const wb = XLSX.utils.book_new();

                // åˆ›å»ºå‚æ•°è¡¨
                const paramsData = [
                    ['å‚æ•°åç§°', 'æ•°å€¼', 'å•ä½'],
                    ['æŠ•æ”¾ç«™ç‚¹æ•°é‡', params.sites, 'ä¸ª'],
                    ['æ¯ç«™ç‚¹æ—¥å‡è®¢å•', params.ordersPerSite, 'å•'],
                    ['å•æ¬¡ç§Ÿèµä»·æ ¼', params.pricePerOrder, 'å…ƒ'],
                    ['å•ç«™è®¾å¤‡æˆæœ¬', params.deviceCost, 'å…ƒ'],
                    ['åœºåœ°åˆ†æˆæ¯”ä¾‹', params.venueCommission, '%']
                ];
                const wsParams = XLSX.utils.aoa_to_sheet(paramsData);
                XLSX.utils.book_append_sheet(wb, wsParams, 'è¾“å…¥å‚æ•°');

                // åˆ›å»ºç»“æœè¡¨
                const resultsData = [
                    ['æŒ‡æ ‡åç§°', 'æ•°å€¼', 'å•ä½'],
                    ['æ—¥è¥ä¸šé¢', results.revenue.daily.toFixed(2), 'å…ƒ'],
                    ['æœˆè¥ä¸šé¢', results.revenue.monthly.toFixed(2), 'å…ƒ'],
                    ['å¹´è¥ä¸šé¢', results.revenue.yearly.toFixed(2), 'å…ƒ'],
                    ['åˆå§‹æŠ•èµ„', results.costs.initial.toFixed(2), 'å…ƒ'],
                    ['æœˆè¿è¥æˆæœ¬', results.costs.monthlyOperating.toFixed(2), 'å…ƒ'],
                    ['æœˆå‡€åˆ©æ¶¦', results.profit.monthlyNet.toFixed(2), 'å…ƒ'],
                    ['å¹´å‡€åˆ©æ¶¦', results.profit.yearlyNet.toFixed(2), 'å…ƒ'],
                    ['æŠ•èµ„å›æ”¶æœŸ', results.metrics.paybackPeriodMonths.toFixed(1), 'æœˆ'],
                    ['å¹´åŒ–ROI', results.metrics.annualROI.toFixed(2), '%'],
                    ['å‡€åˆ©ç‡', results.metrics.netMargin.toFixed(2), '%']
                ];
                const wsResults = XLSX.utils.aoa_to_sheet(resultsData);
                XLSX.utils.book_append_sheet(wb, wsResults, 'è®¡ç®—ç»“æœ');

                XLSX.writeFile(wb, `å…±äº«å……ç”µå®ROIåˆ†æ_${new Date().toLocaleDateString()}.xlsx`);
            };

            const exportToImage = () => {
                alert('å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...\n\nå°†ç”Ÿæˆç²¾ç¾çš„å…³é”®æŒ‡æ ‡å¡ç‰‡å›¾ï¼Œæ–¹ä¾¿åˆ†äº«');
            };

            const shareLink = () => {
                const url = new URL(window.location.href);
                url.searchParams.set('params', btoa(JSON.stringify(params)));

                navigator.clipboard.writeText(url.toString()).then(() => {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    alert('åˆ†äº«é“¾æ¥ï¼š\n' + url.toString());
                });
            };

            return (
                <div className="mt-8 pt-6 border-t border-gray-200">
                    <h3 className="text-lg font-bold text-gray-800 mb-4">å¯¼å‡ºæŠ¥å‘Š</h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <button
                            onClick={exportToPDF}
                            className="px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition font-medium flex items-center justify-center gap-2"
                        >
                            <span>ğŸ“„</span> PDFæŠ¥å‘Š
                        </button>
                        <button
                            onClick={exportToExcel}
                            className="px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium flex items-center justify-center gap-2"
                        >
                            <span>ğŸ“Š</span> Excelè¡¨æ ¼
                        </button>
                        <button
                            onClick={exportToImage}
                            className="px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition font-medium flex items-center justify-center gap-2"
                        >
                            <span>ğŸ–¼ï¸</span> å›¾ç‰‡åˆ†äº«
                        </button>
                        <button
                            onClick={shareLink}
                            className="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition font-medium flex items-center justify-center gap-2"
                        >
                            <span>ğŸ”—</span> é“¾æ¥åˆ†äº«
                        </button>
                    </div>
                </div>
            );
        }

        // ========== æ¸²æŸ“åº”ç”¨ ==========
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
